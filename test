import http from 'k6/http';
import { check } from 'k6';

export const options = {
  stages: [
    { duration: '2s', target: 1000 },   // Tăng lên 1000 VU trong 2s
    { duration: '1000m', target: 1000 },  // Giữ 1000 VU trong 10 phút
    { duration: '2m', target: 0 },      // Giảm dần về 0
  ],
  thresholds: {
    'http_req_duration': ['p(95)<800'],
    'http_req_failed': ['rate<0.01'],
  },
};

export default function () {
  const targetUrl = (__ENV.TARGET_URL || 'https://google.com').trim();

  let res;
  try {
    res = http.get(targetUrl);
  } catch (e) {
    console.error(`❌ Exception in http.get(): ${e.message}`);
    return;
  }

  if (!res || typeof res.status !== 'number') {
    console.error('❌ Response is null or malformed:', res);
    return;
  }

  check(res, {
    'status is 200': (r) => r.status === 200,
  });
}

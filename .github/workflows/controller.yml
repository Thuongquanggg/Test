name: ğŸ”„ Äiá»u Khiá»ƒn VÃ²ng Láº·p Test

on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:

permissions:
  actions: write

jobs:
  control-loop:
    runs-on: ubuntu-latest
    steps:
      # BÆ¯á»šC QUAN TRá»ŒNG: ThÃªm bÆ°á»›c nÃ y vÃ o Ä‘áº§u tiÃªn
      # BÆ°á»›c nÃ y sáº½ táº£i mÃ£ nguá»“n vÃ  thÆ° má»¥c .git vá» mÃ¡y áº£o
      - name: Checkout repository code
        uses: actions/checkout@v4

      - name: 1. Khá»Ÿi cháº¡y Test cho URL 1 (certapple.com)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Báº¯t Ä‘áº§u cháº¡y Test.yml vá»›i target_url=https://certapple.com"
          # Giáº£ sá»­ file test cá»§a báº¡n tÃªn lÃ  Test.yml
          gh workflow run Test.yml --ref ${{ github.ref_name }} -f target_url='https://certapple.com'

      - name: 2. Chá» 3 phÃºt
        run: |
          echo "ÄÃ£ khá»Ÿi cháº¡y. Sáº½ chá» trong 3 phÃºt (180 giÃ¢y)..."
          sleep 180

      - name: 3. Dá»«ng workflow Test.yml Ä‘ang cháº¡y
        uses: styfle/cancel-workflow-action@0.12.1
        with:
          workflow_id: Test.yml 
          access_token: ${{ secrets.GITHUB_TOKEN }}

      - name: 4. Nghá»‰ 2 phÃºt
        run: |
          echo "ÄÃ£ dá»«ng Test.yml. Báº¯t Ä‘áº§u nghá»‰ trong 2 phÃºt (120 giÃ¢y)..."
          sleep 120

      - name: 5. Khá»Ÿi cháº¡y Test cho URL 2 (github.com)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Háº¿t thá»i gian nghá»‰. Báº¯t Ä‘áº§u cháº¡y Test.yml vá»›i target_url=https://github.com"
          gh workflow run Test.yml --ref ${{ github.ref_name }} -f target_url='https://github.com'

      - name: 6. HoÃ n thÃ nh chu trÃ¬nh
        run: |
          echo "ÄÃ£ khá»Ÿi cháº¡y láº§n test thá»© hai. Chu trÃ¬nh nÃ y Ä‘Ã£ hoÃ n táº¥t."

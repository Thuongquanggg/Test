# üÖæÔ∏è .github/workflows/controller.yml
name: üîÑ ƒêi·ªÅu Khi·ªÉn V√≤ng L·∫∑p Slow
on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:
permissions:
  actions: write
jobs:
  control-loop:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Kh·ªüi ch·∫°y Slow cho URL 1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "B·∫Øt ƒë·∫ßu ch·∫°y Slow.yml v·ªõi target_url=https://certapple.com"
          gh workflow run Slow.yml --ref ${{ github.ref_name }} -f target_url='https://certapple.com'
      - name: 2. Ch·ªù 3 ph√∫t
        run: |
          echo "ƒê√£ kh·ªüi ch·∫°y. S·∫Ω ch·ªù trong 3 ph√∫t (180 gi√¢y)..."
          sleep 180
      - name: 3. D·ª´ng workflow Slow.yml ƒëang ch·∫°y
        uses: styfle/cancel-workflow-action@0.12.1
        with:
          workflow_id: Slow.yml 
          access_token: ${{ secrets.GITHUB_TOKEN }}
      - name: 4. Ngh·ªâ 2 ph√∫t
        run: |
          echo "ƒê√£ d·ª´ng Slow.yml. B·∫Øt ƒë·∫ßu ngh·ªâ trong 2 ph√∫t (120 gi√¢y)..."
          sleep 120
      - name: 5. Kh·ªüi ch·∫°y Test cho URL 2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "H·∫øt th·ªùi gian ngh·ªâ. B·∫Øt ƒë·∫ßu ch·∫°y Slow.yml v·ªõi target_url=https://certapple.com"
          gh workflow run Slow.yml --ref ${{ github.ref_name }} -f target_url='https://certapple.com'
      - name: 6. Ho√†n th√†nh chu tr√¨nh
        run: |
          echo "ƒê√£ kh·ªüi ch·∫°y l·∫ßn test th·ª© hai. Chu tr√¨nh n√†y ƒë√£ ho√†n t·∫•t."
          echo "V√≤ng l·∫∑p ti·∫øp theo s·∫Ω ƒë∆∞·ª£c k√≠ch ho·∫°t b·ªüi 'schedule' sau kho·∫£ng 15 ph√∫t."


# Tên của toàn bộ workflow, hiển thị trong tab "Actions"
name: k6 Load Test for Certapple

# Tên của một lần chạy cụ thể, sẽ hiển thị URL được test
run-name: Testing ${{ github.event.inputs.target_url }}

on:
  # Cho phép chạy workflow này thủ công từ giao diện GitHub
  workflow_dispatch:
    inputs:
      # THAY ĐỔI 1: Sửa mô tả và giá trị mặc định cho input
      target_url:
        description: 'URL của trang web cần test (ví dụ: https://certapple.com)'
        required: true
        default: 'https://certapple.com' # Giá trị mặc định là một URL hợp lệ

jobs:
  k6-load-test-run: # Đổi tên job cho dễ hiểu
    # THAY ĐỔI 2: Đổi tên job hiển thị trên giao diện
    name: Run k6 Load Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run k6 test
        uses: grafana/k6-action@v0.3.1
        with:
          # THAY ĐỔI 3 (QUAN TRỌNG NHẤT): Chỉ định đúng tên file script .js của bạn
          # Hãy đảm bảo tên file này khớp với tên file bạn đã lưu mã k6.
          filename: test
        env:
          # Dòng này đã đúng. Nó lấy input 'target_url' và gán vào biến môi trường TARGET_URL
          # Kịch bản k6 của chúng ta sẽ đọc biến này (__ENV.TARGET_URL)
          TARGET_URL: ${{ github.event.inputs.target_url }}

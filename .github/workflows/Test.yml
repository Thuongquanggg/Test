# .github/workflows/Test.yml

# Tên của toàn bộ workflow, hiển thị trong tab "Actions"
name: k6 Load Test for Certapple

# Tên của một lần chạy cụ thể, sẽ hiển thị URL được test
run-name: Testing ${{ github.event.inputs.target_url }}

on:
  # Cho phép chạy workflow này thủ công từ giao diện GitHub
  # HOẶC được gọi bởi một workflow khác (ví dụ: Scheduler.yml)
  workflow_dispatch:
    inputs:
      target_url:
        description: 'URL của trang web cần test (ví dụ: https://certapple.com)'
        required: true
        default: 'https://certapple.com'

jobs:
  k6-load-test-run:
    name: Run k6 Load Test
    
    # <<< GIỚI HẠN THỜI GIAN CHẠY CỦA JOB NÀY LÀ 3 PHÚT >>>
    # Nếu job chạy quá 3 phút, GitHub sẽ tự động dừng nó.
    timeout-minutes: 3
    
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run k6 test
        uses: grafana/k6-action@v0.3.1
        with:
          # Đảm bảo tên file này khớp với tên file script của bạn (ví dụ: test.js)
          filename: test.js
        env:
          # Nhận URL từ input của workflow_dispatch
          TARGET_URL: ${{ github.event.inputs.target_url }}

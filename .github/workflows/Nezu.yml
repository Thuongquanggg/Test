name: k6 Browser Test

on: [push]

jobs:
  k6-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Bước 1: Đăng nhập vào GitHub Container Registry. Bước này đã đúng và giữ nguyên.
      - name: Login to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Bước 2: Chạy k6, nhưng chỉ định một phiên bản cụ thể
      - name: Run k6 browser test
        run: |
          docker run --rm -i \
            -v ${{ github.workspace }}:/github/workspace \
            -w /github/workspace \
            # === THAY ĐỔI QUAN TRỌNG: Sử dụng phiên bản cụ thể thay vì :latest ===
            ghcr.io/grafana/xk6-browser:0.50.0 \
            run nezushub-browser.js

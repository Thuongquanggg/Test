name: k6 Browser Test

on: [push]

jobs:
  k6-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # === BƯỚC MỚI QUAN TRỌNG: Đăng nhập vào GitHub Container Registry ===
      - name: Login to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          # Sử dụng GITHUB_TOKEN để xác thực.
          # password phải là ${{ secrets.GITHUB_TOKEN }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Bước chạy k6 giữ nguyên như cũ
      - name: Run k6 browser test
        run: |
          docker run --rm -i \
            -v ${{ github.workspace }}:/github/workspace \
            -w /github/workspace \
            ghcr.io/grafana/xk6-browser:latest \
            run nezushub-browser.js

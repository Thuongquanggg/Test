# TÃªn file: .github/workflows/start-loop.yml

# TÃªn cá»§a workflow sáº½ hiá»ƒn thá»‹ trÃªn giao diá»‡n Actions cá»§a GitHub
name: ğŸš€ 1. Bat Dau Vong Lap

# === PHáº¦N KÃCH HOáº T ===
# on: workflow_dispatch cho phÃ©p báº¡n cháº¡y workflow nÃ y má»™t cÃ¡ch thá»§ cÃ´ng
# báº±ng cÃ¡ch nháº¥n nÃºt "Run workflow" trÃªn giao diá»‡n Actions.
on:
  workflow_dispatch:

# === PHáº¦N CÃ”NG VIá»†C ===
jobs:
  # TÃªn cá»§a job, báº¡n cÃ³ thá»ƒ Ä‘áº·t tÃ¹y Ã½
  start_the_loop:
    # TÃªn cá»§a job sáº½ hiá»ƒn thá»‹ trÃªn giao diá»‡n
    name: Gui Tin Hieu De Khoi Dong
    # LuÃ´n sá»­ dá»¥ng mÃ¡y áº£o Ubuntu má»›i nháº¥t cá»§a GitHub
    runs-on: ubuntu-latest

    # CÃ¡c bÆ°á»›c sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n trong job nÃ y
    steps:
      # BÆ°á»›c nÃ y cÃ³ má»™t nhiá»‡m vá»¥ duy nháº¥t: gá»­i má»™t tÃ­n hiá»‡u Ä‘áº¿n repo.
      - name: Gui tin hieu "repository_dispatch"
        # DÃ¹ng lá»‡nh 'curl' Ä‘á»ƒ gá»i Ä‘áº¿n API cá»§a GitHub
        run: |
          echo "Dang gui tin hieu 'start-k6-loop' de khoi dong vong lap chinh..."
          
          curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            # DÃ²ng quan trá»ng nháº¥t: Sá»­ dá»¥ng token bÃ­ máº­t báº¡n Ä‘Ã£ táº¡o Ä‘á»ƒ xÃ¡c thá»±c.
            # GitHub sáº½ tá»± Ä‘á»™ng láº¥y token tá»« Secrets cá»§a repo.
            -H "Authorization: Bearer ${{ secrets.PAT_FOR_DISPATCH }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            # API endpoint Ä‘á»ƒ gá»­i tÃ­n hiá»‡u.
            # ${{ github.repository }} lÃ  biáº¿n cÃ³ sáºµn, sáº½ tá»± Ä‘iá»n "Thuongquanggg/Test".
            https://api.github.com/repos/${{ github.repository }}/dispatches \
            # Dá»¯ liá»‡u gá»­i Ä‘i: má»™t sá»± kiá»‡n cÃ³ tÃªn lÃ  "start-k6-loop".
            -d '{"event_type":"start-k6-loop"}'

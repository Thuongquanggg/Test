# Tên file: .github/workflows/start-loop.yml

# Tên của workflow sẽ hiển thị trên giao diện Actions của GitHub
name: 🚀 1. Bat Dau Vong Lap

# === PHẦN KÍCH HOẠT ===
# on: workflow_dispatch cho phép bạn chạy workflow này một cách thủ công
# bằng cách nhấn nút "Run workflow" trên giao diện Actions.
on:
  workflow_dispatch:

# === PHẦN CÔNG VIỆC ===
jobs:
  # Tên của job, bạn có thể đặt tùy ý
  start_the_loop:
    # Tên của job sẽ hiển thị trên giao diện
    name: Gui Tin Hieu De Khoi Dong
    # Luôn sử dụng máy ảo Ubuntu mới nhất của GitHub
    runs-on: ubuntu-latest

    # Các bước sẽ được thực hiện trong job này
    steps:
      # Bước này có một nhiệm vụ duy nhất: gửi một tín hiệu đến repo.
      - name: Gui tin hieu "repository_dispatch"
        # Dùng lệnh 'curl' để gọi đến API của GitHub
        run: |
          echo "Dang gui tin hieu 'start-k6-loop' de khoi dong vong lap chinh..."
          
          curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            # Dòng quan trọng nhất: Sử dụng token bí mật bạn đã tạo để xác thực.
            # GitHub sẽ tự động lấy token từ Secrets của repo.
            -H "Authorization: Bearer ${{ secrets.PAT_FOR_DISPATCH }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            # API endpoint để gửi tín hiệu.
            # ${{ github.repository }} là biến có sẵn, sẽ tự điền "Thuongquanggg/Test".
            https://api.github.com/repos/${{ github.repository }}/dispatches \
            # Dữ liệu gửi đi: một sự kiện có tên là "start-k6-loop".
            -d '{"event_type":"start-k6-loop"}'

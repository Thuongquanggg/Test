# .github/workflows/Scheduler.yml

name: Schedule and Trigger k6 Tests

on:
  schedule:
    - cron: '*/4 * * * *'
  workflow_dispatch:

jobs:
  trigger-load-tests:
    name: Trigger 10 k6 Test Runs
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        run_number: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

    steps:
      # BƯỚC 1: TẢI CODE VỀ RUNNER
      # Đây là bước cực kỳ quan trọng để runner có thể tìm thấy file Test.yml ở local.
      - name: Checkout repository
        uses: actions/checkout@v4

      # BƯỚC 2: GỌI REUSABLE WORKFLOW
      # Bây giờ runner đã có code, nó sẽ tìm thấy và gọi được file Test.yml
      - name: Run k6 Load Test Workflow (Run #${{ matrix.run_number }})
        uses: ./.github/workflows/Test.yml
        with:
          target_url: 'https://certapple.com'
